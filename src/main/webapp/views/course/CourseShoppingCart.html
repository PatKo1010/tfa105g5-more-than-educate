<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en" dir="ltr">

<head>
    <title>MoreThanEducate</title>
    <meta charset="UTF-8" />
    <meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileColor" content="#9f00a7">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="../">
    <!-- 綠界標投 -->
    <meta http-equiv="Content-Language" content="zh-TW">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="description"
        content="綠界科技 ECPay 提供信用卡刷卡、超商代收及取貨付款、ATM轉帳...等多種金流收款服務，會員可於綠界網站建立收款網址或使用API程式串接，應用彈性，收款隔日起即撥款。支付找綠界，買賣無國界。">
    <!-- 必填，限制 81-150 字 -->
    <meta name="keywords" content="信用卡,ATM轉帳,超商代碼,超商條碼,applepay,googlepay,samsungpay,金流服務">




    <link rel="shortcut icon" href="../public/favicon.ico" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:100,300,500,600,700,900&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../public/css/plugins.min.css" />
    <link rel="stylesheet" href="../public/css/styles.css" />
    <style>
        .table {
            table-layout: fixed;
            word-break: break-all;
            overflow: hidden;
        }

        .overflow {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .sum {
            float: right;
            font-family: Microsoft JhengHei;
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <!-- Loading -->
    <div id="preloader" class="preloader">
        <div class="preloader-inner">
            <div class="preloader-6">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
    <!-- / -->
    <!--Overlay-->
    <span class="mega-menu-overlay"></span>
    <!--Header-->
    <header class="app-header app-header-1 boxed">
        <div class="container">
            <div class="header-wrap">
                <button class="button button-menu button-open-sidenav">
                    <span></span>
                </button>
                <div class="header-menu">
                    <ul>
                        <li class="has-menu" data-megamenu-link="mega-menu-1">
                            <div class="mega-menu-link">
                                <span class="title">前往</span>
                                <span class="icon fa fa-angle-left"></span>
                            </div>
                            <div data-megamenu-id="mega-menu-1" class="mega-menu mega-menu-1">
                                <div class="mega-menu-inner">
                                    <div>
                                        <div class="espard-menu">
                                            <div class="row row-xl-5">
                                                <!--Col-->
                                                <div class="col">
                                                    <p class="title">Quick Access</p>
                                                    <ul>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Teacher Profile</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">List of Teachers</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Course Details</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">List of Courses</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <!--/-->
                                                <!--Col-->
                                                <div class="col">
                                                    <p class="title">Quick Access</p>
                                                    <ul>
                                                        <li>
                                                            <a href="page-blog.html">
                                                                <span class="text">Blog/News</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-single-post.html">
                                                                <span class="text">Single Post</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-cooperation.html">
                                                                <span class="text">Cooperation</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-departements.html">
                                                                <span class="text">Departements</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-start.html">
                                                                <span class="text">Getting Started!</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <!--/-->
                                                <!--Col-->
                                                <div class="col">
                                                    <p class="title">個人中心</p>
                                                    <ul>
                                                        <li>
                                                            <a
                                                                href="/tfa105g5-more-than-educate/views/member/dashboard.jsp">
                                                                <span class="text">個人首頁</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a
                                                                href="/tfa105g5-more-than-educate/views/member/profile.jsp">
                                                                <span class="text">個人資料</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Edit Skills</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Adding Classrooms</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <!--/-->
                                                <!--Col-->
                                                <div class="col">
                                                    <p class="title">Other Pages</p>
                                                    <ul>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Sign-In Page</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Sign-Up Page</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Link Content</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <span class="text">Link Content</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <!--/-->
                                                <!--Col-->
                                                <div class="col">
                                                    <p class="title">Communication</p>
                                                    <ul>
                                                        <li>
                                                            <a href="page-about.html">
                                                                <span class="text">About Us</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-contact.html">
                                                                <span class="text">Contact Us</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-faq.html">
                                                                <span class="text">FAQ</span>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="page-policy.html">
                                                                <span class="text">Policy</span>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <!--/-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="/tfa105g5-more-than-educate/views/member/teacherProfile.jsp">
                                <span class="text">成為老師</span>
                                <span class="icon fa fa-angle-left"></span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="header-logo">
                    <a href="/tfa105g5-more-than-educate/index.jsp" class="primary-logo">
                        <span class="text-1">MoreThanEducate</span>
                        <span class="text-2"></span>
                    </a>
                </div>
                <div class="header-links">
                    <form action="/tfa105g5-more-than-educate/views/member/logout" method="post">
                        <button class="button button-md button-primary" type="submit">登出</button>
                    </form>
                </div>
            </div>
        </div>
    </header>
    <!--/-->
    <!--Sidenav-->
    <div class="app-sidenav app-sidenav-1">
        <div class="sidenav-menu">
            <div class="sidenav-head">
                <img src="assets/images/sidenav.jpg" alt="sidenav banner">
                <button class="button button-close-sidenav"></button>
            </div>
            <div class="sidenav-body">
                <div class="sidenav-body-inner">
                    <div class="sidenav-links">
                        <a href="page-login.html" class="button button-md button-block button-line-primary">
                            <span class="text">Sign In</span>
                        </a>
                        <a href="page-register.html" class="button button-md button-block button-primary">
                            <span class="text">Sign Up</span>
                        </a>
                    </div>
                    <ul>
                        <li>
                            <a href="home.html">
                                <span class="text">Home</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                        </li>
                        <li class="has-menu">
                            <a href="#">
                                <span class="text">All Pages</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                            <div class="mega-menu">
                                <p class="title">Quick Access</p>
                                <ul class="sidenav-menu-ul">
                                    <li>
                                        <a href="page-blog.html">
                                            <span class="text">Blog/News</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-single-post.html">
                                            <span class="text">Single Post</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-cooperation.html">
                                            <span class="text">Cooperation</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-start.html">
                                            <span class="text">Getting Started!</span>
                                        </a>
                                    </li>
                                </ul>
                                <p class="title">Quick Access</p>
                                <ul class="sidenav-menu-ul">
                                    <li>
                                        <a href="page-teacher.html">
                                            <span class="text">Teacher</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-teachers.html">
                                            <span class="text">List of Teachers</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-course.html">
                                            <span class="text">Course Details</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-courses.html">
                                            <span class="text">List of Courses</span>
                                        </a>
                                    </li>
                                </ul>
                                <p class="title">Dashboard</p>
                                <ul class="sidenav-menu-ul">
                                    <li>
                                        <a href="teacher/dashboard.html">
                                            <span class="text">Dashboard</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="teacher/dashboard-profile.html">
                                            <span class="text">Profile</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="teacher/dashboard-skills.html">
                                            <span class="text">Edit Skills</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="teacher/dashboard-classrooms.html">
                                            <span class="text">Classrooms</span>
                                        </a>
                                    </li>
                                </ul>
                                <p class="title">Communication</p>
                                <ul class="sidenav-menu-ul">
                                    <li>
                                        <a href="page-about.html">
                                            <span class="text">About Us</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-contact.html">
                                            <span class="text">Contact Us</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-faq.html">
                                            <span class="text">FAQ</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-policy.html">
                                            <span class="text">Policy</span>
                                        </a>
                                    </li>
                                </ul>
                                <p class="title">Other Pages</p>
                                <ul class="sidenav-menu-ul">
                                    <li>
                                        <a href="page-login.html">
                                            <span class="text">Sign-In</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-register.html">
                                            <span class="text">Sign-Up</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="page-departements.html">
                                            <span class="text">Departements</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="has-menu">
                            <a href="#">
                                <span class="text">Languages</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                            <div class="mega-menu">
                                <ul>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/uk.svg" alt="alt" />
                                                <h3>English</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/germany.svg" alt="alt" />
                                                <h3>German</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/france.svg" alt="alt" />
                                                <h3>French</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/italy.svg" alt="alt" />
                                                <h3>Italian</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/china.svg" alt="alt" />
                                                <h3>Chinese</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/japan.svg" alt="alt" />
                                                <h3>Japanese</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/south-korea.svg" alt="alt" />
                                                <h3>Korean</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/russia.svg" alt="alt" />
                                                <h3>Russian</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/arabic.svg" alt="alt" />
                                                <h3>Arabic</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/turkey.svg" alt="alt" />
                                                <h3>Turkish</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/iran.svg" alt="alt" />
                                                <h3>Persian</h3>
                                            </a>
                                        </div>
                                    </li>
                                    <li class="el-flag">
                                        <div class="inner">
                                            <a href="page-departements.html">
                                                <img src="assets/images/flags/spain.svg" alt="alt" />
                                                <h3>Spanish</h3>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="page-teachers.html">
                                <span class="text">Teachers</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                        </li>
                        <li>
                            <a href="page-courses.html">
                                <span class="text">Courses</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                        </li>
                        <li>
                            <a href="page-cooperation.html">
                                <span class="text">Join Now.</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                        </li>
                        <li>
                            <a href="page-start.html">
                                <span class="text">Let's get started</span>
                                <span class="icon fa fa-angle-right"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <span class="sidenav-close"></span>
    </div>
    <!--/-->
    <!--Wrapper-->
    <div class="app-wrapper">
        <div class="page page-dashboard page-dashboard-student">
            <!--Section-->
            <section class="section section-dashboard section-dashboard-student">
                <div class="container">
                    <div class="display-spacing display-spacing-plus">


                        <div class="col-12 col-sm-12 col-md-12 col-lg-8">
                            <div class="el-panel el-panel-admin-status" style="width:1000px">
                                <div class="el-panel-body">
                                    <div class="el-panel-title">
                                        <h2>購物車</h2>

                                        <table id="cart">
                                            <tr>
                                                <th>課程</th>
                                                <th>課程總堂數</th>
                                                <th>價格</th>
                                                <th>刪除課程</th>
                                            </tr>


                                            <!-- </form> -->
                                        </table>

                                        <div class="sum ">總計：<span id="totalPrice"></span></div>
                                        <br>
                                        <div>
                                            <input type="hidden">
                                        </div>
                                        <div>
                                            <button id="pay-button"
                                                class="button button-md button-block button-primary">
                                                <span class="text">確認支付</span>
                                            </button>
                                        </div>
                                        <!-- 綠界付款頁面 -->
                                        <div class="order-info">
                                            <div class="oi-lan-box">
                                                <div class="oi-lan" style="text-align: right;">
                                                    <select id="Language">
                                                        <option value="zh-TW">繁體中文</option>
                                                        <option value="en-US">English</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="ECPayPayment"></div><br />

                                            <form action="" id="PayProcess" method="post">
                                                <div style="text-align: center;">

                                                    <input id="PaymentType" name="PaymentType" type="hidden" value="" />
                                                    <input id="btnPay" type="button" class="btn single btn-gray-dark"
                                                        value="確認付款" />
                                                </div>
                                                <br />
                                                <div style="text-align: center;">
                                                    消費者選擇付款方式取得的PayToken : <input id="PayToken" name="PayToken"
                                                        type="Text" size="50" value="" />
                                                </div>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        </section>
        <!--/-->
    </div>
    </div>
    <script src="../public/js/jquery.min.js"></script>
    <script src="../public/js/plugins.min.js"></script>
    <script src="../public/js/main-scripts.js"></script>
    <script src="../public/js/dashboard.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/node-forge@0.7.0/dist/forge.min.js"></script>
    <script src="https://ecpg.ecpay.com.tw/Scripts/sdk-1.0.0.js?t=20210121100116"></script>
    <script>
        const totalPriceEle = document.querySelector('#totalPrice');
        window.addEventListener("load", e => {
            fetch("/tfa105g5-more-than-educate/course/shoppingCart", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then((data) => {
                    sessionStorage.setItem("orders", JSON.stringify(data));
                    const sumPrice = document.querySelector('#totalPrice')
                    const cartTable = document.querySelector("#cart")
                    for (let i = 0; i < data.length; i++) {

                        const courseid = data[i].courseid
                        const memid = data[i].memid
                        const expertiseid = data[i].expertiseid
                        const coursetitle = data[i].coursetitle
                        const courseintro = data[i].courseintro
                        const classamount = data[i].classamount
                        const price = data[i].price
                        const username = data[i].username
                        const photo = data[i].photo
                        cartTable.innerHTML +=
                            `<tr>
                                <td class="overflow">
                                    <input type="checkbox" data-price="${price}" onclick="checkboxChange(event)" checked >
                                    <a href="/tfa105g5-more-than-educate/views/courseDetail?courseId=${courseid}">
                                        <img src="data:image/png;base64,${photo}" style="width:50px;height:50px"/>
                                    </a>
                                    ${coursetitle}
                                </td>
                                <td>${classamount}</td>
                                <td>${price}</td>
                                <td>
                                    <input name= "courseid" type= "hidden" value ='${courseid}'/> 
                                    
                                    <button onclick="sremCourse(${courseid})" class="button button-primary" style="width:50px;height:30px;">刪除</button>
                                </td>
                            </tr>    
                            <br>                                                            
                             `;
                        sumPrice.innerHTML = +sumPrice.innerHTML + price
                    }
                    return sumPrice;

                })
        })

        function sremCourse(courseid) {
            const url = 'http://localhost:7080/tfa105g5-more-than-educate/course/sremCourse';
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ courseid })
            })
                .then(response => response.json())
                .then(body => {
                    location.reload();
                });
        }

        function checkboxChange(e) {
            const curPrice = +e.target.dataset.price;
            const totalPrice = +totalPriceEle.textContent
            if (e.target.checked) {
                totalPriceEle.textContent = curPrice + totalPrice;
            } else {
                totalPriceEle.textContent = totalPrice - curPrice;
            }
        }

        $("#pay-button").on("click", function (e) {

            const order = sessionStorage.getItem("orders");


            fetch(
                "/tfa105g5-more-than-educate/course/getEcpayToken",
                {
                    'method': 'POST',
                    'headers': { 'content-type': 'application/json' },
                    'body': order
                }
            ).then(response => response.json())
                .then((data) => {
                    alert(data.token);
                    initToken(data.token, data.orderId);



                })
        })

        function initToken(token, orderId) {
            var Environment = 'STAGE'; //請設定要連線的環境: 測試 STAGE ,正式PROD
            var envi = GetEnvi(Environment);
            var _token = token; //請設定你取到的廠商驗證碼

            //初始化SDK畫面
            ECPay.initialize(envi, 1, function (errMsg) {

                if (_token === '') {
                    _token = prompt('請填入Token: ');
                }

                try {
                    ECPay.createPayment(_token, ECPay.Language.zhTW, function (errMsg) {
                        //console.log('Callback Message: ' + errMsg);
                        if (errMsg != null)
                            ErrHandle(errMsg);
                    });
                    $('#Language').val(ECPay.Language.zhTW);
                } catch (err) {
                    ErrHandle(err);
                }
            });

            //切換SDK語系	
            $('#Language').on('change', function () {
                try {
                    ECPay.createPayment(_token, $('#Language').val(), function (errMsg) {
                        //console.log('Callback Message: ' + errMsg);
                        if (errMsg != null)
                            ErrHandle(errMsg);
                    });

                } catch (err) {
                    ErrHandle(null);
                }
            });

            //消費者選擇完成付款方式,取得PayToken 
            $('#btnPay').click(function () {

                try {
                    ECPay.getPayToken(function (paymentInfo, errMsg) {
                        //console.log("response => getPayToken(paymentInfo, errMsg):", paymentInfo, errMsg);
                        if (errMsg != null) {
                            ErrHandle(errMsg);
                            return;
                        };
                        const payToken = $("#PayToken").val(paymentInfo.PayToken);
                        fetch(
                            `/tfa105g5-more-than-educate/course/EcpaymentToken/${paymentInfo.PayToken}/${orderId}`,
                            {
                                'method': 'GET'
                            }
                        ).then(response => response.json())
                            .then((data) => {
                                alert("成功");




                            })



                        //$("#PayProcess").submit();
                        return true;
                    });
                } catch (err) {
                    // ErrHandle(err);
                }

                return false;
            });
        }

        function GetEnvi(env) {
            var result = 'STAGE';
            switch (env) {

                case 'STAGE':
                    result = 'Stage';
                    break;
                case 'PROD':
                    result = 'Prod';
                    break;
            }
            return result;
        }

        function ErrHandle(strErr) {

            if (strErr != null) {
                $('#ECPayPayment').append('<div style="text-align: center;"><label style="color: red;">' + strErr + '</label></div>');
                console.log(strErr);
            } else {
                $('#ECPayPayment').append('<div style="text-align: center;"><label style="color: red;">Token取得失敗</label></div>');
                console.log('Wrong');
            }

        }

    </script>

    <!-- <script type="text/javascript">

        $(function () {
            var Environment = 'STAGE'; //請設定要連線的環境: 測試 STAGE ,正式PROD
            var envi = GetEnvi(Environment);
            var _token = '973f1acf4d7f48abb0cb5de789b69b8f'; //請設定你取到的廠商驗證碼

            //初始化SDK畫面
            ECPay.initialize(envi, 1, function (errMsg) {

                if (_token === '') {
                    _token = prompt('請填入Token: ');
                }

                try {
                    ECPay.createPayment(_token, ECPay.Language.zhTW, function (errMsg) {
                        //console.log('Callback Message: ' + errMsg);
                        if (errMsg != null)
                            ErrHandle(errMsg);
                    });
                    $('#Language').val(ECPay.Language.zhTW);
                } catch (err) {
                    ErrHandle(err);
                }
            });

            //切換SDK語系	
            $('#Language').on('change', function () {
                try {
                    ECPay.createPayment(_token, $('#Language').val(), function (errMsg) {
                        //console.log('Callback Message: ' + errMsg);
                        if (errMsg != null)
                            ErrHandle(errMsg);
                    });

                } catch (err) {
                    ErrHandle(null);
                }
            });

            //消費者選擇完成付款方式,取得PayToken 
            $('#btnPay').click(function () {

                try {
                    ECPay.getPayToken(function (paymentInfo, errMsg) {
                        //console.log("response => getPayToken(paymentInfo, errMsg):", paymentInfo, errMsg);
                        if (errMsg != null) {
                            ErrHandle(errMsg);
                            return;
                        };
                        $("#PayToken").val(paymentInfo.PayToken);

                        //$("#PayProcess").submit();
                        return true;
                    });
                } catch (err) {
                    // ErrHandle(err);
                }

                return false;
            });
        });

        function GetEnvi(env) {
            var result = 'STAGE';
            switch (env) {

                case 'STAGE':
                    result = 'Stage';
                    break;
                case 'PROD':
                    result = 'Prod';
                    break;
            }
            return result;
        }

        function ErrHandle(strErr) {

            if (strErr != null) {
                $('#ECPayPayment').append('<div style="text-align: center;"><label style="color: red;">' + strErr + '</label></div>');
                console.log(strErr);
            } else {
                $('#ECPayPayment').append('<div style="text-align: center;"><label style="color: red;">Token取得失敗</label></div>');
                console.log('Wrong');
            }

            //$('#btnPay').hide();
        }
    </script> -->

</body>

</html>